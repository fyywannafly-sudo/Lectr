-- FyyCommunity Loader - FULL DEBUG (tanpa Kick)
local HttpService = game:GetService("HttpService")

local API_URL = "https://loretta-metalline-bebe.ngrok-free.dev/validate"

local function validateKey()
    if not _G.script_key then
        error("[Fyy Loader] _G.script_key belum di-set")
    end

    local hwid = game:GetService("RbxAnalyticsService"):GetClientId()
    local player = game.Players.LocalPlayer
    local robloxId = player and player.UserId or 0
    local placeId = game.PlaceId

    local url = string.format(
        "%s?key=%s&hwid=%s&robloxId=%s&placeId=%s",
        API_URL,
        HttpService:UrlEncode(_G.script_key),
        HttpService:UrlEncode(hwid),
        tostring(robloxId),
        tostring(placeId)
    )

    warn("[Fyy Loader] URL:", url)

    -- HttpGet + pcall
    local ok, resOrErr = pcall(function()
        return game:HttpGet(url)
    end)

    warn("[Fyy Loader] HttpGet OK?", ok)
    warn("[Fyy Loader] typeof(resOrErr):", typeof(resOrErr))
    warn("[Fyy Loader] POTONGAN RESPON (1â€“200):")
    warn(string.sub(tostring(resOrErr), 1, 200))

    if not ok then
        warn("[Fyy Loader] HttpGet ERROR:", tostring(resOrErr))
        return
    end

    local response = resOrErr

    -- ==== COBA JSONDECODE ====
    local okDecode, dataOrErr = pcall(function()
        return HttpService:JSONDecode(response)
    end)

    warn("[Fyy Loader] JSONDecode OK?", okDecode)

    if not okDecode then
        warn("[Fyy Loader] JSONDecode gagal! error:", tostring(dataOrErr))
        return
    end

    local data = dataOrErr
    warn("[Fyy Loader] DATA TABLE:", data)

    -- print field penting
    warn("[Fyy Loader] status:", data.status)
    warn("[Fyy Loader] code  :", data.code)
    warn("[Fyy Loader] msg   :", data.message)

    if data.status ~= "ok" then
        warn("[Fyy Loader] SERVER ERROR:", data.message or "Key error")
        return
    end

    print("[Fyy Loader] Validation OK:", data.code, data.message)
end

validateKey()

print("[Fyy Loader] Script premium MULAI jalan untuk key:", _G.script_key)
-- load script utama kalau mau
-- loadstring(game:HttpGet("https://raw.githubusercontent.com/fyywannafly-sudo/panel/refs/heads/main/FyyCommunity"))()
